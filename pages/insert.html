<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Library Management System - Insert Single Book</title>
	<link rel="stylesheet" href="../css/insert.css">
	<script src="../js/awesome.js"></script>
	<link href="https://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet">
	<script src="https://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.js"></script>

</head>

<nav class="sidebar-navigation">
	<ul>
		<li class="active">
			<i class="fas fa-book"></i>
			<span class="tooltip">Insert Single Book</span>
		</li>
		<li>
			<i class="fas fa-stream" onclick="window.location.href='./insert-multi.html'"></i>
			<span class="tooltip">Insert Multiple Books</span>
		</li>
		<li>
			<i class="fas fa-search" onclick="window.location.href='./search.html'"></i>
			<span class="tooltip">Search</span>
		</li>
		<li>
			<i class="fas fa-book-reader" onclick="window.location.href='./borrow.html'"></i>
			<span class="tooltip">Borrow</span>
		</li>
		<li>
			<i class="fas fa-undo" onclick="window.location.href='./return.html'"></i>
			<span class="tooltip">Return</span>
		</li>
		<li>
			<i class="fas fa-id-card" onclick="window.location.href='./card.html'"></i>
			<span class="tooltip">Card Services</span>
		</li>
		<li>
			<i class="fas fa-sign-out-alt" onclick="window.location.href='../index.html'"></i>
			<span class="tooltip">Log Out</span>
		</li>
	</ul>
</nav>

<body background="../assets/img/main.jpg">

	<br>
	<h1 style="text-align: center; color: white; font-family: Hacked; src: url('../assets/font/Hacked.ttf');">
		Insert a Single Book
	</h1>
	<div class='container'>
		<div class='window'>
			<div class='overlay'></div>
			<div class='content'>
				<div class='input-fields'>
					<input id="bno" type='text' placeholder='Book Number' class='input-line full-width'></input>
					<input id="category" type='text' placeholder='Category' class='input-line full-width'></input>
					<input id="title" type='text' placeholder='Title' class='input-line full-width'></input>
					<input id="press" type='text' placeholder='Press' class='input-line full-width'></input>
					<input id="year" type='text' placeholder='Year' class='input-line full-width'></input>
					<input id="author" type='text' placeholder='Author' class='input-line full-width'></input>
					<input id="price" type='text' placeholder='Price' class='input-line full-width'></input>
				</div>
				<div><button class='ghost-round full-width' onclick="insertSingle()">Submit</button></div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		function insertSingle() {
			var mysql = require('mysql')
			var config = require('../db-config')
			var connection = mysql.createConnection(config.db)
			connection.connect()

			var bno = document.getElementById('bno').value
			var category = document.getElementById('category').value
			var title = document.getElementById('title').value
			var press = document.getElementById('press').value
			var year = document.getElementById('year').value
			var author = document.getElementById('author').value
			var price = document.getElementById('price').value

			if (bno && category && title && press && year && author && price) {
				connection.query('SELECT * FROM book WHERE bno= ?', [bno], function (error, rst, fields) {
					if (rst.length > 0) {
						if (rst[0].category == category && rst[0].title == title && rst[0].press == press && rst[0].year == year && rst[0].author == author && rst[0].price == price) {
							connection.query('UPDATE book SET total=total+1 WHERE bno= ?', [bno])
							connection.query('UPDATE book SET stock=stock+1 WHERE bno= ?', [bno])
							swal({
								title: "Found A Book",
								text: "Increment the stock by 1",
								type: "success",
								timer: 2000,
								showConfirmButton: false
							})
						}
						else {
							swal({
								title: "Incompatible Information",
								text: "Found the same book number, but the information doesn't match",
								type: "error",
								timer: 2000,
								showConfirmButton: false
							})
						}
					} else {
						connection.query('INSERT INTO book VALUES(?,?,?,?,?,?,?,1,1)', [bno, category, title, press, year, author, price], function (error, rst, fields) {
							if (error) {
								swal({
									title: "Insert Failed",
									text: error,
									type: "error",
									timer: 2000,
									showConfirmButton: false
								})
							}
							else {
								swal({
									title: "No Book Fount, Insert One",
									text: "Please re-check the information",
									type: "success",
									timer: 2000,
									showConfirmButton: false
								})
							}
						})

					}
				})
			}
			else {
				swal({
					title: "Incomplete Information",
					text: "Please re-check the information",
					type: 'error',
					timer: 2000,
					showConfirmButton: false
				})
			}
		}
	</script>
</body>

</html>